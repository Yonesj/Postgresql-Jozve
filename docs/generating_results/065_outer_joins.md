### **جلسه ۶۵: اتصال خارجی (OUTER JOIN)**

اتصال خارجی (OUTER JOIN) دسته‌ای از JOINها را شامل می‌شود که به شما در حفظ ردیف‌های بدون تطابق کنترل می‌دهد. این دسته سه نوع اصلی دارد:

- `LEFT OUTER JOIN`
- `RIGHT OUTER JOIN`
- `FULL OUTER JOIN`

که به‌اختصار `LEFT JOIN`، `RIGHT JOIN` و `FULL JOIN` نیز نوشته می‌شوند.

---

#### **۱. مفهوم کلی و تفاوت با INNER JOIN**

در `INNER JOIN` تنها ردیف‌هایی که در هر دو جدول تطابق دارند بازمی‌گردند و ردیف‌های بدون تطابق حذف می‌شوند. در مقابل، در یک `OUTER JOIN` شما مشخص می‌کنید که کدام سمت (چپ یا راست) باید به‌طور کامل نگه داشته شود، حتی اگر ردیف‌های متناظری در سمت دیگر وجود نداشته باشد. در `FULL JOIN` هر دو سمت کامل نگه داشته می‌شوند و ردیف‌های بدون تطابق نیز بازگردانده می‌شوند.

---

#### **۲. LEFT JOIN — نگهداری کامل جدول سمت چپ**

در `LEFT JOIN` تمام ردیف‌های جدولِ تعیین‌شده به‌عنوان «چپ» همیشه در خروجی حضور دارند. اگر برای یک ردیف از جدول چپ تطابقی در جدول راست وجود نداشته باشد، ستون‌های مربوط به جدول راست با `NULL` پر می‌شوند.

```postgresql
SELECT *
FROM users
LEFT JOIN bookmarks ON users.id = bookmarks.user_id
LIMIT 10;
```

برای یافتن ردیف‌هایی که در جدول راست تطابق ندارند (یعنی کاربران بدون بوکمارک)، می‌توان از شرط `WHERE bookmarks.id IS NULL` استفاده کرد؛ ردیف‌های حاصل نشان‌دهندهٔ کاربرانِ «بدون بوکمارک» هستند.

<div class='centered-div'>
  <img src="../../assets/images/generating_results/65.png">
</div>

---

#### **۳. RIGHT JOIN — نگهداری کامل جدول سمت راست**

در `RIGHT JOIN` تمام ردیف‌های جدولِ سمت راست همیشه در خروجی هستند. اگر ردیفی در جدول راست تطابقی در جدول چپ نداشته باشد، ستون‌های جدول چپ در خروجی `NULL` خواهند بود.

```postgresql
SELECT *
FROM users
RIGHT JOIN bookmarks ON users.id = bookmarks.user_id;
```

با این نگارش می‌توان ردیف‌هایی از `bookmarks` را دید که صاحب (owner) ندارند؛ آن‌ها به‌عنوان ردیف‌هایی با `NULL` در ستون‌های `users` نمایش داده می‌شوند.

---

#### **۴. FULL JOIN — نگهداری کامل هر دو جدول**

در `FULL JOIN` هر دو جدول به‌طور کامل نگه داشته می‌شوند. این نوع JOIN هم ردیف‌های جدول چپ را که تطابق ندارند و هم ردیف‌های جدول راست را که تطابق ندارند بازمی‌گرداند، و ردیف‌های تطابق‌یافته را نیز نشان می‌دهد.

```postgresql
SELECT *
FROM users
FULL JOIN bookmarks ON users.id = bookmarks.user_id;
```

نتیجهٔ این پرس‌وجو شامل همهٔ کاربران، همهٔ بوکمارک‌ها، بوکمارک‌های یتیم (بدون صاحب) و کاربران بدون بوکمارک خواهد بود. این نوع در عمل کمتر مورد استفاده قرار می‌گیرد.

---

#### **۵. نکات نوشتاری و معادل‌سازی**

نوشتن `LEFT JOIN` یا `RIGHT JOIN` یا `FULL JOIN` به‌طور ضمنی به معنای «outer» است؛ یعنی می‌توانید `LEFT JOIN` را به‌جای `LEFT OUTER JOIN` بنویسید. استفاده از `LEFT OUTER JOIN` یا `FULL OUTER JOIN` نیز صحیح است اما ضروری نیست.
