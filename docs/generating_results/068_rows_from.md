### **جلسه ۶۸: دستور `ROWS FROM`**

این جلسه به معرفی یک تکنیک خاص برای قرار دادن خروجی چند تابع مجموعه‌ساز (`set-generating function`) در کنار یکدیگر به صورت ستون‌های مجزا، بدون نیاز به عملیات `JOIN`، اختصاص دارد.

---

#### **۱. چالش اصلی: قرار دادن دو لیست در کنار هم**

گاهی اوقات ما دو لیست یا سری از داده‌ها داریم که می‌خواهیم آن‌ها را به صورت دو ستون مجزا در کنار هم نمایش دهیم. از آنجایی که این لیست‌ها معمولاً کلید مشترکی برای `JOIN` ندارند، و `CROSS JOIN` نیز یک حاصل‌ضرب دکارتی تولید می‌کند که مد نظر ما نیست، به یک راهکار دیگر نیاز داریم.

---

#### **۲. راه‌حل: استفاده از `ROWS FROM`**

دستور `ROWS FROM` به ما اجازه می‌دهد تا خروجی چند تابع مجموعه‌ساز را به صورت ستون‌های موازی در کنار یکدیگر قرار دهیم. سینتکس آن ممکن است در ابتدا کمی عجیب به نظر برسد:

```postgresql
SELECT * FROM ROWS FROM (function1(...), function2(...));
```

PostgreSQL خروجی هر تابع را در یک ستون مجزا قرار می‌دهد و آن‌ها را ردیف به ردیف در کنار هم می‌چیند.

---

#### **۳. ویژگی‌های کلیدی `ROWS FROM`**

- **نام‌گذاری ستون‌ها:** شما می‌توانید با استفاده از `AS`، برای هر تابع و ستون خروجی آن یک نام مستعار (alias) تعیین کنید تا نتایج خواناتر شوند.

  ```postgresql
  ... ROWS FROM (
        generate_series(1, 10),
        generate_series(100, 110)
      ) AS t(lower_numbers, upper_numbers)
  ```

- **مدیریت طول‌های نامساوی:** اگر تعداد ردیف‌های خروجی توابع با هم برابر نباشد، `ROWS FROM` به صورت خودکار ستون کوتاه‌تر را با مقادیر `NULL` پر می‌کند (`null padding`) تا طول هر دو ستون یکسان شود.

---

#### **۴. کاربرد عملی: ایجاد یک جدول جستجوی تاریخ**

یک مثال کاربردی برای `ROWS FROM`، ایجاد یک جدول جستجوی پویا برای تاریخ‌هاست. برای مثال، می‌توانیم یک سری از تمام روزهای یک سال را با `generate_series` تولید کرده و در کنار آن، یک سری از اعداد ۱ تا ۳۶۶ را قرار دهیم تا شماره روز سال را نیز داشته باشیم.

```postgresql
SELECT *
FROM ROWS FROM (
	generate_series('2024-01-01'::date, '2024-12-31'::date, '1 day'),
	generate_series(1, 366)
) AS t(day_of_year, num)
WHERE day_of_year IS NOT NULL;
```

این کوئری یک جدول مجازی تولید می‌کند که هر روز سال را در کنار شماره متناظر آن روز نمایش می‌دهد.

---

#### **۵. کاربرد با دیگر توابع مجموعه‌ساز (مانند `unnest`)**

قابلیت `ROWS FROM` محدود به `generate_series` نیست و با هر تابع مجموعه‌ساز دیگری، مانند `unnest` (که برای تبدیل آرایه به ردیف استفاده می‌شود)، نیز کار می‌کند. شما می‌توانید خروجی `unnest` کردن چند آرایه مختلف را به صورت ستون‌های مجزا در کنار یکدیگر قرار دهید.

```postgresql
SELECT * FROM ROWS FROM (
	UNNEST(ARRAY[101, 102, 103]),
	UNNEST(ARRAY['laptop', 'smartphone', 'tablet']),
	UNNEST(ARRAY[999.99, 499.49, 299.99])
) AS combined(product_id, product_name, price);
```

---

#### **۶. جمع‌بندی**

اگرچه `ROWS FROM` ممکن است یکی از پرکاربردترین ویژگی‌های PostgreSQL نباشد، اما یک ابزار بسیار مفید و خاص برای زمانی است که شما نیاز دارید خروجی دو یا چند لیست یا سری را بدون هیچ رابطه کلیدی، به صورت ستون‌های موازی در کنار هم قرار دهید. اکنون شما این ابزار را در جعبه ابزار خود دارید.
