### **جلسه 27: انواع داده مربوط به آدرس‌های شبکه**

ذخیره آدرس‌های شبکه یا آدرس‌های مک (MAC) در پایگاه داده شاید خیلی رایج نباشد، اما غیرمعمول هم نیست. اگر زمانی نیاز به ذخیره این نوع داده‌ها داشتید، PostgreSQL انواع داده تخصصی برای این کار ارائه می‌دهد که هم از نظر فضای ذخیره‌سازی و هم از نظر کارایی در کوئری‌نویسی، بسیار بهینه‌تر از ذخیره آن‌ها به صورت متن (`text`) هستند. این انواع داده به شما اجازه می‌دهند تا عملیاتی مانند جستجو در یک محدوده (range) یا استخراج بخش‌هایی از یک آدرس را بدون نیاز به تجزیه (parse) کردن متن انجام دهید.

---

#### **۱. نوع داده `INET`: برای آدرس‌های میزبان (Host Addresses)**

نوع داده `INET` برای ذخیره آدرس‌های IP (هم IPv4 و هم IPv6) به همراه ماسک زیرشبکه (subnet mask) اختیاری به کار می‌رود. ذخیره یک آدرس IP به عنوان `INET` بسیار فشرده‌تر از ذخیره آن به عنوان `text` است. برای مثال، یک آدرس IPv6 که به صورت متن ۴۰ بایت فضا اشغال می‌کند، در نوع داده `INET` تنها ۲۲ بایت فضا می‌گیرد. این بار دیگر ثابت می‌کند که انتخاب نوع داده‌ای که به بهترین شکل واقعیت را نمایندگی می‌کند، چقدر مهم است. یک آدرس IP در واقعیت یک رشته متنی نیست، بلکه یک ساختار داده‌ای مشخص است.

```postgresql
CREATE TABLE inet_example (
	id BIGINT GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
	ip_address INET
);

INSERT INTO inet_example (ip_address)
VALUES
	('10.0.0.1'),                             -- Host address without subnet
	('192.168.1.10/24'),                      -- Host address with subnet mask
	('::1/128'),                              -- IPv6 loopback address
	('2001:db8::/32'),                        -- IPv6 network
	('2001:db8:85a3:8d3:1319:8a2e:370:7348'); -- IPv6 host address
```

**توابع کاربردی:** PostgreSQL توابع مفیدی برای کار با نوع داده `INET` ارائه می‌دهد:

- `()host`: فقط بخش آدرس میزبان را برمی‌گرداند.
- `()masklen`: طول ماسک زیرشبکه را برمی‌گرداند.
- `()network`: فقط بخش شبکه آدرس را برمی‌گرداند.
- `()abbrev`: یک نمایش خلاصه‌شده از آدرس را ارائه می‌دهد.

این توابع به شما اجازه می‌دهند تا بدون نیاز به پردازش‌های پیچیده متنی، به راحتی با بخش‌های مختلف یک آدرس IP کار کنید.

<div class="centered-div" style="padding: 1rem 0;">
<img src="../../assets/images/advanced_data_types/inet_utility_functions.png" alt="select query output" />
</div>

---

#### **۲. نوع داده `CIDR`: برای محدوده‌های شبکه**

نوع داده `CIDR` (Classless Inter-Domain Routing) به طور خاص برای نمایش و کار با **محدوده‌های شبکه** طراحی شده است. این نوع داده نیز مانند `INET` به صورت یک ساختار باینری فشرده ذخیره می‌شود که کار با آن را بسیار بهینه می‌کند. قدرت واقعی این نوع داده در بخش کوئری‌نویسی مشخص خواهد شد، جایی که از آن برای بررسی اینکه آیا یک آدرس IP در یک محدوده شبکه خاص قرار دارد یا خیر، استفاده خواهیم کرد.

```postgresql
CREATE TABLE cidr_example (
	id BIGINT GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
	network_address CIDR
);

INSERT INTO cidr_example (network_address)
VALUES
	('192.168.0.0/24'),  -- Network with IPv4
	('10.0.0.0/8'),      -- Larger IPv4 network
	('2001:db8::/48');   -- IPv4 network
```

---

#### **۳. انواع داده `macaddr` و `macaddr8`: برای آدرس‌های MAC**

PostgreSQL دو نوع داده برای ذخیره آدرس‌های MAC ارائه می‌دهد.

- **`macaddr` (۶ بایتی):** برای فرمت استاندارد ۶ بایتی آدرس‌های MAC.
- **`macaddr8` (۸ بایتی):** برای فرمت جدیدتر و ۸ بایتی آدرس‌های MAC (EUI-64).

استفاده از این انواع داده نیز به شدت از نظر فضای ذخیره‌سازی بهینه است. یک آدرس MAC که به صورت متن ۲۱ بایت فضا می‌گیرد، در این انواع داده تنها ۶ یا ۸ بایت فضا اشغال می‌کند. شما می‌توانید یک آدرس ۶ بایتی را به نوع ۸ بایتی تبدیل (cast) کنید، اما برعکس آن ممکن نیست.

---

#### **۴. جمع‌بندی**

اگرچه این انواع داده ممکن است کاربردهای بسیار خاصی داشته باشند، اما اگر با آدرس‌های شبکه سروکار دارید، استفاده از این انواع داده تخصصی به جای `text` یک انتخاب هوشمندانه و بهینه است. این کار نه تنها باعث صرفه‌جویی در فضا می‌شود، بلکه امکانات قدرتمندی را برای کوئری‌نویسی در اختیار شما قرار می‌دهد.
