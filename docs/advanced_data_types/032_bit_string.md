### **جلسه ۳۲: رشته‌های بیتی (Bit Strings)**

این جلسه به یکی از انواع داده خاص و کمتر رایج به نام رشته بیتی (Bit String) اختصاص دارد. یک رشته بیتی، همانطور که از نامش پیداست، رشته‌ای متشکل از مقادیر خاموش و روشن (صفر و یک) است.

---

#### **۱. ماهیت و چالش‌های رشته‌های بیتی**

بزرگترین چالش کار با رشته‌های بیتی این است که برای انسان کاملاً **مبهم و ناخوانا (opaque)** هستند. وقتی به یک رشته از صفر و یک نگاه می‌کنید، درک اینکه هر بیت چه معنایی دارد، تقریباً غیرممکن است. به همین دلیل، نباید از این نوع داده به صورت گسترده استفاده کرد، زیرا همکاران شما را دچار سردرگمی خواهد کرد. با این حال، برای برخی کارهای خاص، این نوع داده ابزار مناسبی است.

---

#### **۲. نحوه ایجاد و تعریف رشته‌های بیتی**

برای تعریف یک رشته بیتی، می‌توانید از پیشوند `B` به همراه رشته‌ای از صفر و یک استفاده کنید. همچنین می‌توانید یک رشته معمولی را به نوع `bit` با طول مشخص تبدیل (cast) کنید. هر دو روش نتیجه یکسانی دارند.

```postgres
SELECT pg_typeof(B'0001'), pg_typeof('0001'::BIT(4)); -- bit | bit
```

---

#### **۳. کاربرد اصلی: ذخیره‌سازی مجموعه‌ای از وضعیت‌های Boolean**

کاربرد اصلی رشته‌های بیتی، ذخیره‌سازی مجموعه‌ای از اطلاعات `true/false` یا `on/off` در یک ستون واحد است. اگر فقط دو یا سه وضعیت بولین دارید، بهتر است از دو یا سه ستون مجزای `BOOLEAN` استفاده کنید. اما زمانی که تعداد این وضعیت‌ها زیاد می‌شود (مثلاً ۶۴ وضعیت)، ایجاد ۶۴ ستون مجزا منطقی نیست و یک رشته بیتی می‌تواند راهکار بهینه‌ای باشد.

یک جایگزین دیگر برای این کار، استفاده از یک ستون `INTEGER` و انجام عملیات بیتی (bitwise operations) روی آن است. انتخاب بین `INTEGER` و `BIT STRING` تا حدودی سلیقه‌ای است، اما رشته بیتی این مزیت را دارد که وقتی به آن نگاه می‌کنید، به وضوح می‌بینید که با مجموعه‌ای از بیت‌ها سروکار دارید، در حالی که دیدن یک عدد (مثلاً `۱۷`) به تنهایی هیچ اطلاعاتی در مورد ساختار بیتی آن به شما نمی‌دهد.

---

#### **۴. عملیات بیتی با استفاده از بیت‌ماسک (Bitmask)**

یکی از کاربردهای عملی رشته‌های بیتی، استفاده از آن‌ها برای پیاده‌سازی پرچم‌های ویژگی (feature flags) است. برای بررسی اینکه آیا یک ویژگی خاص برای یک کاربر فعال است یا خیر، می‌توان از تکنیک بیت‌ماسک استفاده کرد.

یک بیت‌ماسک، رشته بیتی دیگری است که در آن، بیت مربوط به ویژگی مورد نظر ما روشن (`1`) و بقیه خاموش (`0`) هستند. با استفاده از عملگر `&` (AND بیتی)، می‌توانیم این ماسک را روی رشته بیتی کاربر اعمال کنیم. نتیجه این عملیات، یک رشته بیتی جدید خواهد بود که در آن، یک بیت تنها در صورتی روشن است که در **هر دو** رشته ورودی (رشته کاربر و ماسک) روشن بوده باشد. به این ترتیب، می‌توانیم به راحتی فعال بودن یک یا چند ویژگی را بررسی کنیم.

---

#### **۵. انواع `bit` و `bit varying` در تعریف جدول**

در PostgreSQL دو نوع ستون برای رشته‌های بیتی وجود دارد:

- **`bit(n)`:** این نوع داده یک رشته بیتی با **طول ثابت `n`** را ذخیره می‌کند. اگر رشته‌ای با طول متفاوت وارد کنید، با خطا مواجه خواهید شد.
- **`bit varying(n)`:** این نوع داده یک رشته بیتی با **طول متغیر تا سقف `n`** را ذخیره می‌کند.

```postgresql
CREATE TABLE bits (
	bit3 BIT(3),
	bitv BIT VARYING(32)
);
```

---

#### **۶. جمع‌بندی و جایگزین‌ها**

رشته‌های بیتی را به عنوان یک ابزار تخصصی در جعبه ابزار خود به خاطر بسپارید. هر زمان که با مسئله‌ای مواجه شدید که ساختاری شبیه به ماسک‌گذاری بیتی دارد، این نوع داده می‌تواند راه‌حل مناسبی باشد. با این حال، به یاد داشته باشید که برای حل همین مسئله، راهکارهای دیگری نیز وجود دارد:

- استفاده از ستون‌های `INTEGER` و عملیات بیتی.
- استفاده از ستون‌های `BOOLEAN` مجزا (برای تعداد کم).
- استفاده از یک ستون `JSON`.
- استفاده از یک جدول مجزا.

به عنوان یک توسعه‌دهنده، این شما هستید که باید با توجه به نیازهای پروژه، بهترین راه‌حل را انتخاب کنید.
