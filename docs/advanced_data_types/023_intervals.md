### **جلسه 23: بازه‌های زمانی (Intervals)**

شاید تصور می‌کردید که با پوشش دادن تاریخ و زمان، کارمان با مفاهیم زمانی تمام شده است، اما PostgreSQL ابزار قدرتمند دیگری به نام `Interval` دارد. یک `Interval` یک **نقطه زمانی مشخص** نیست، بلکه یک **مدت زمان (duration)** یا یک بازه زمانی را نشان می‌دهد.

---

#### **۱. معرفی Interval و کاربردهای آن**

اگرچه `Interval` یکی از رایج‌ترین انواع داده نیست، اما دانستن وجود آن بسیار مهم است زیرا می‌تواند کوئری‌هایی را که در حالت عادی بسیار پیچیده هستند، به طرز شگفت‌انگیزی ساده کند. قدرت واقعی این نوع داده در بخش کوئری‌نویسی دوره مشخص خواهد شد، جایی که از آن برای کاربردهایی مانند بررسی همپوشانی دو بازه زمانی (مثلاً دو زمان رزرو اتاق کنفرانس) یا پیدا کردن اینکه آیا یک نقطه زمانی خاص در داخل یک بازه قرار دارد یا نه، استفاده خواهیم کرد.

---

#### **۲. روش‌های تعریف و ایجاد Interval**

چندین روش برای تعریف یک `Interval` در PostgreSQL وجود دارد. یک روش رایج، استفاده از فرمت استاندارد و خوانای PostgreSQL است که در آن واحدهای زمانی مختلف مانند سال، ماه، روز، ساعت، دقیقه و ثانیه به همراه مقدارشان مشخص می‌شوند. برای مثال:

```postgresql
SELECT '[quantity] [unit] ...'::INTERVAL;  -- format
SELECT '1 year 2 months 3 days 4 hours 5 minutes 6 seconds'::INTERVAL; -- 1 year 2 mons 3 days 04:05:06
SELECT '1 year 2 months 3 days 04:05:06'::INTERVAL; -- same result
```

روش دیگر، استفاده از کلمه کلیدی `INTERVAL` به همراه یک رشته است. برای مثال، `INTERVAL '2' year` یک بازه دو ساله ایجاد می‌کند. این روش همچنین به شما اجازه می‌دهد تا بازه‌های ترکیبی مانند `INTERVAL '1-6' YEAR TO MONTH` (یک سال و شش ماه) یا بازه‌هایی بر اساس یک واحد کوچکتر مانند `INTERVAL '6000' second` (که به ۱ ساعت و ۴۰ دقیقه تبدیل می‌شود) را تعریف کنید.

```postgresql
SELECT INTERVAL '2' YEAR;             -- 2 years
SELECT INTERVAL '1-6' YEAR TO MONTH;  -- 1 year 6 mons
SELECT INTERVAL '6000' SECOND;        -- 01:40:00
```

---

#### **۳. کنترل فرمت نمایش با `IntervalStyle`**

شما می‌توانید با تنظیم `IntervalStyle`، فرمت نمایش خروجی `Interval` را کنترل کنید. حالت پیش‌فرض `postgres` است که فرمتی خوانا و واضح را نمایش می‌دهد. حالت دیگر `iso_8601` است که خروجی را به فرمت استاندارد و بسیار فشرده‌تری تبدیل می‌کند که با حرف `P` (مخفف Period) شروع می‌شود. برای مثال، `P1Y2M3DT4H5M6S`. یک فرمت جایگزین `iso_8601` نیز وجود دارد که ظاهری شبیه به `timestamp` دارد اما با `P` شروع می‌شود. انتخاب بین این فرمت‌ها به نیاز و سلیقه شما بستگی دارد.

```postgresql
SHOW intervalstyle; -- postgres
SELECT '1 year 2 months 3 days 04:05:06'::INTERVAL; -- 1 year 2 mons 3 days 04:05:06

SET intervalstyle = 'iso_8601';
SELECT '1 year 2 months 3 days 04:05:06'::INTERVAL; -- P1Y2M3DT4H5M6S --> P 1Y 2M 3D T 4H 5M 6S
```

---

#### **۴. نحوه ذخیره‌سازی هوشمند و اهمیت آن**

نکته بسیار مهم در مورد `Interval`ها، نحوه ذخیره‌سازی داخلی آن‌هاست. PostgreSQL به صورت هوشمند واحدهای زمانی را به صورت **مجزا** ذخیره می‌کند. برای مثال، وقتی شما یک بازه "۲ ماه و ۱۲ روز" را تعریف می‌کنید، PostgreSQL آن را به روز تبدیل نمی‌کند. این هوشمندی حیاتی است زیرا طول یک "ماه" ثابت نیست و می‌تواند ۲۹، ۳۰ یا ۳۱ روز باشد. با ذخیره کردن واحدها به صورت مجزا، PostgreSQL تضمین می‌کند که محاسبات روی این بازه‌ها، حتی با در نظر گرفتن سال‌های کبیسه و ماه‌های کوتاه و بلند، همیشه **دقیق و صحیح** باقی بماند. این ویژگی `Interval`ها را به ابزاری بسیار امن و قابل اعتماد برای ذخیره و کار با مدت زمان تبدیل می‌کند.

---

#### **۵. جمع‌بندی**

در این جلسه با نحوه تعریف و ایجاد `Interval`ها و فرمت‌های مختلف آن‌ها آشنا شدیم. مهم‌ترین نکته، درک این موضوع است که `Interval` یک مدت زمان را به صورت هوشمند و دقیق ذخیره می‌کند. قدرت واقعی این نوع داده زمانی مشخص خواهد شد که در بخش‌های آینده دوره، به کاربردهای عملی آن در کوئری‌نویسی بپردازیم.
