اکنون که یک موتور جستجوی سریع و باکیفیت داریم، باید به یکی از جنبه‌های مهم **تجربه کاربری (user experience)** نیز فکر کنیم و آن، نشان دادن کلمات کلیدی مطابق با جستجوی کاربر در نتایج است. وقتی کاربر کلمه‌ای را جستجو می‌کند، بهتر است آن کلمه را در نتایج highlight شود. خوشبختانه، PostgreSQL یک تابع داخلی برای این کار دارد.

---

### **۱. معرفی تابع `ts_headline`**

تابع `ts_headline` برای برجسته‌سازی کلمات کلیدی در یک متن طراحی شده است. این تابع به صورت زیر استفاده می‌شود:

```postgresql
ts_headline(language, document, query, options)
```

*   `language`: زبان متن (مانند `'english'`).
*   `document`: **متن اصلی** که می‌خواهیم هایلایت در آن انجام شود (مانند ستون `title`). نکته مهم این است که این تابع روی `tsvector` کار نمی‌کند، بلکه روی متن خام اولیه عمل می‌کند.
*   `query`: آن `tsquery` که کاربر برای جستجو استفاده کرده است.
*   `options` (اختیاری): یک رشته برای تنظیمات پیشرفته.

**مثال:**

```postgresql
SELECT 
	ts_headline('english', title, websearch_to_tsquery('Star Wars')) AS title_highlighted
FROM 
	movies
WHERE 
	search_vectors @@ websearch_to_tsquery('"star wars"')
ORDER BY 
	ts_rank(search_vectors, websearch_to_tsquery('"star wars"')) DESC;
```

??? note "خروجی کوئری بالا"
    <div class='centered-div'>
      <img src="../../assets/images/full_text_search/96.png">
    </div>


این کوئری کلمات `Star` و `Wars` را در عنوان فیلم‌ها پیدا کرده و آن‌ها را با تگ‌های `<b>` و `<b/>` احاطه می‌کند.

---

### **۲. سفارشی‌سازی تگ‌های هایلایت**

رفتار پیش‌فرض `ts_headline` استفاده از تگ‌های `<b>` است. اما شما می‌توانید با استفاده از پارامتر چهارم (`options`)، این تگ‌ها را به هر چیزی که می‌خواهید تغییر دهید. این کار به شما اجازه می‌دهد تا از تگ‌های معنایی‌تر (semantic) مانند `<mark>` استفاده کرده و کنترل بیشتری روی استایل‌دهی در سمت فرانت‌اند داشته باشید.

برای این کار، گزینه‌ها را به صورت یک رشته `key=value` و با جداکننده کاما مشخص می‌کنیم:

```postgresql
SELECT 
	ts_headline(
		'english',
		title, 
		websearch_to_tsquery('Star Wars'),
		'StartSel=<mark>, StopSel=</mark>'
	) AS title_highlighted
FROM 
	movies
...
```

*   `StartSel`: تگ شروع برجسته‌سازی.
*   `StopSel`: تگ پایان برجسته‌سازی.

گزینه‌های بسیار دیگری نیز برای این پارامتر وجود دارد (مانند کنترل طول خلاصه و...) که می‌توانید در [مستندات PostgreSQL](https://www.postgresql.org/docs/current/textsearch-controls.html#TEXTSEARCH-HEADLINE) آن‌ها را مطالعه کنید.

---

### **۳. مزیت کار کردن روی سند اصلی**

یکی از مزایای بزرگ `ts_headline` این است که روی سند (`document`) اصلی کار می‌کند، نه `tsvector`. این به ما اجازه می‌دهد تا هایلایت را به صورت مجزا برای هر ستون (مانند `title` و `plot`) انجام دهیم.

شما می‌توانید کل عنوان فیلم را به همراه کلمات هایلایت شده به کاربر نمایش دهید و در عین حال، فقط یک **خلاصه یا گزیده (excerpt/snippet)** از ستون `plot` را که شامل کلمات هایلایت شده است، نشان دهید. این قابلیت (که در گزینه‌های `ts_headline` قابل کنترل است) به ایجاد یک رابط کاربری بسیار تمیز و کاربرپسند کمک می‌کند.

---

### **۴. جمع‌بندی**

تابع `ts_headline` ابزاری قدرتمند و داخلی در PostgreSQL برای هایلایت کردن نتایج جستجو است. با استفاده از این تابع و گزینه‌های سفارشی‌سازی آن، می‌توانید به راحتی یک تجربه جستجوی بسیار بهتر و واضح‌تر برای کاربران خود فراهم کنید. این قابلیت، یکی دیگر از قطعات پازلی است که به شما اجازه می‌دهد یک موتور جستجوی تمام‌عیار را تنها با استفاده از PostgreSQL بسازید.