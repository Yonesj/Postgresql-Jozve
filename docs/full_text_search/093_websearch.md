اکنون که با سینتکس زیربنایی `tsquery` آشنا شدیم، به سراغ توابع کمکی می‌رویم که به ما اجازه می‌دهند یک عبارت ساده را به یک `tsquery` پیچیده تبدیل کنیم. این توابع، تجربه جستجو را برای کاربر نهایی بسیار بهتر می‌کنند.

---

### **۱. تابع `plainto_tsquery`**

این تابع، اولین سطح از ابزارهای کمکی است. `plainto_tsquery` یک رشته متنی ساده دریافت کرده و تمام کلمات آن را با اپراتور `&` (AND) به یکدیگر متصل می‌کند.

```postgresql
SELECT plainto_tsquery('Star Wars');  -- 'star' & 'war'
```

این تابع به صورت خودکار کلمات را به ریشه زبانی (lexeme) آن‌ها تبدیل می‌کند (مثلاً `Wars` به `war` تبدیل می‌شود). اما این تابع قابلیت استفاده از اپراتورهای پیچیده‌تر مانند `OR` یا جستجوی عبارت دقیق را ندارد.

---

### **۲. تابع `phraseto_tsquery`**

این تابع، یک سطح بالاتر از `plainto_tsquery` قرار دارد. `phraseto_tsquery` یک عبارت را دریافت کرده و آن را به یک `tsquery` تبدیل می‌کند که در آن، کلمات باید **دقیقاً به همان ترتیب و پشت سر هم** در متن وجود داشته باشند (با استفاده از اپراتور `<->`).

```postgresql
SELECT phraseto_tsquery('Star Wars'); -- 'star' <-> 'war'
```
این تابع برای جستجوی عبارت‌های دقیق بسیار مفید است.

---

### **۳. تابع `websearch_to_tsquery`: بهترین ابزار برای تجربه کاربری**

در این نقطه، ممکن است فکر کنید که قابلیت‌های جستجوی PostgreSQL هنوز برای یک کاربر نهایی بسیار محدود و دست‌وپاگیر است. اما خوشبختانه، ما ابزار دیگری نیز در اختیار داریم: **`websearch_to_tsquery`**.

این تابع به گونه‌ای طراحی شده است که سینتکسی شبیه به اپراتورهای جستجوی گوگل را شبیه‌سازی می‌کند و یک تجربه جستجوی بسیار آشنا و قدرتمند را برای کاربر نهایی فراهم می‌کند.

*   **جستجوی عبارت دقیق:** قرار دادن کلمات در داخل کوتیشن (`"..."`)، آن‌ها را به یک جستجوی عبارت دقیق (مانند `phraseto_tsquery`) تبدیل می‌کند.
*   **اپراتور `OR`:** استفاده از کلمه `OR` بین کلمات، آن‌ها را با اپراتور `|` (OR) ترکیب می‌کند.
*   **اپراتور `NOT`:** قرار دادن علامت منفی (`-`) قبل از یک کلمه، آن کلمه را از نتایج جستجو حذف می‌کند (با استفاده از اپراتور `!`).

```postgresql
SELECT websearch_to_tsquery('star wars or trek -clone'); 
-- 'star' & 'war' | 'trek' & !'clone'
```

---

### **۴. دو مزیت بزرگ `websearch_to_tsquery`**

1.  **تجربه کاربری آشنا:** این سینتکس دقیقاً همان چیزی است که کاربران امروزی با آن آشنا هستند و انتظار دارند. آموزش آن به کاربران بسیار ساده‌تر از آموزش سینتکس `tsquery` است.

2.  **عدم ایجاد خطا:** برخلاف `to_tsquery` که با یک سینتکس اشتباه، خطا تولید می‌کند، `websearch_to_tsquery` **هرگز خطا نمی‌دهد**. این تابع هر ورودی کاربری را دریافت کرده و تمام تلاش خود را می‌کند تا آن را به یک `tsquery` معتبر تبدیل کند. این ویژگی به شما اجازه می‌دهد تا ورودی کاربر را (پس از پاکسازی اولیه) مستقیماً به این تابع ارسال کنید، بدون اینکه نگران بروز خطاهای سینتکسی باشید.

---

### **۵. جمع‌بندی**

تابع `websearch_to_tsquery` یک ابزار فوق‌العاده قدرتمند است که قابلیت‌های جستجوی تمام‌متن PostgreSQL را به سطح یک تجربه کاربری مدرن و قابل قبول ارتقا می‌دهد. با استفاده از این تابع، شما می‌توانید برای مدت زمان بسیار طولانی‌تری به جستجوی داخلی PostgreSQL تکیه کنید، قبل از اینکه نیاز به مهاجرت به یک موتور جستجوی تخصصی پیدا کنید.