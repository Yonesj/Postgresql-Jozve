### **جلسه ۴۲: کلیدهای اصلی در مقابل ایندکس‌های ثانویه**

قبل از اینکه به نوشتن SQL بازگردیم، لازم است با چند اصطلاح مهم دیگر آشنا شویم. این مفاهیم به درک عمیق‌تر ساختار ایندکس‌ها در PostgreSQL کمک می‌کنند.

---

#### **۱. یک حقیقت عجیب: تمام ایندکس‌ها در PostgreSQL ثانویه هستند**

یک نکته جالب و شاید کمی گیج‌کننده این است که در PostgreSQL، تمام ایندکس‌ها در واقع **ایندکس ثانویه (secondary index)** محسوب می‌شوند، حتی ایندکسی که برای کلید اصلی (primary key) ایجاد می‌شود. برای درک این موضوع، بهتر است PostgreSQL را با پایگاه داده دیگری مانند MySQL مقایسه کنیم.

- **در MySQL:** وقتی شما یک کلید اصلی تعریف می‌کنید، همزمان در حال تعریف **ایندکس خوشه‌ای (clustered index)** هستید. در MySQL، ایندکس خوشه‌ای نحوه چیدمان فیزیکی داده‌ها روی دیسک را مشخص می‌کند. به عبارت دیگر، خود جدول یک ایندکس B-tree است که تمام داده‌های هر ردیف در گره‌های برگ (leaf nodes) آن ذخیره شده‌اند. در MySQL، هر ایندکس دیگری که ایندکس خوشه‌ای نباشد، یک ایندکس ثانویه نامیده می‌شود.

- **در PostgreSQL:** همانطور که در جلسات قبل دیدیم، داده‌ها در PostgreSQL به صورت یک **هیپ (heap)** یا توده نامرتب روی دیسک ذخیره می‌شوند. این یعنی هیچ ایندکس خوشه‌ای وجود ندارد که ترتیب فیزیکی داده‌ها را مشخص کند. به همین دلیل، تمام ایندکس‌ها در PostgreSQL، ایندکس ثانویه هستند.

<div class='centered-div'>
  <img src="../../assets/images/indexing/42.png">
</div>

این تفاوت به این معناست که تقریباً در هر جستجویی که از ایندکس استفاده می‌کند (به جز یک استثنا به نام ایندکس‌های پوششی که بعداً به آن می‌پردازیم)، PostgreSQL ابتدا باید ایندکس را پیمایش کرده و سپس با استفاده از CTID، به هیپ (heap) مراجعه کرده و بقیه داده‌های ردیف را پیدا کند.

---

#### **۲. پس کلید اصلی در PostgreSQL چیست؟**

اگر همه ایندکس‌ها ثانویه هستند، پس نقش کلید اصلی چیست؟ یک کلید اصلی در PostgreSQL، یک نوع خاص از ایندکس ثانویه است؛ می‌توان آن را یک **"ایندکس ثانویه++"** در نظر گرفت.

وقتی شما یک ستون را به عنوان کلید اصلی تعریف می‌کنید، PostgreSQL به صورت خودکار سه کار را برای شما انجام می‌دهد:

1.  محدودیت **`UNIQUE`** را روی آن ستون اعمال می‌کند.
2.  محدودیت **`NOT NULL`** را روی آن ستون اعمال می‌کند.
3.  یک **ایندکس ثانویه** از نوع B-tree روی آن ستون برای شما ایجاد می‌کند.

بنابراین، شما نیازی به ایجاد دستی ایندکس برای کلید اصلی ندارید.

---

#### **۳. تفاوت‌های کلیدی**

- **تعداد:** هر جدول می‌تواند **فقط یک** کلید اصلی داشته باشد (همانطور که از نامش پیداست: `primary` به معنای اصلی و اولی است).
- **ایندکس‌های دیگر:** شما می‌توانید هر تعداد ایندکس ثانویه دیگر که می‌خواهید روی جدول خود داشته باشید. این ایندکس‌های دیگر نیز می‌توانند دارای محدودیت‌های `UNIQUE` یا `NOT NULL` باشند، اما از نظر مفهومی با کلید اصلی تفاوت دارند.

---

#### **۴. جمع‌بندی**

به طور خلاصه، به یاد داشته باشید که در PostgreSQL، تمام ایندکس‌ها از نوع **ثانویه** هستند، زیرا هیچ ایندکس خوشه‌ای برای تعیین ترتیب فیزیکی داده‌ها وجود ندارد. کلید اصلی یک نوع خاص از ایندکس ثانویه است که به صورت خودکار محدودیت‌های `UNIQUE` و `NOT NULL` را نیز اعمال می‌کند.
