### **جلسه ۳۹: مقدمه‌ای بر ایندکس‌ها**

به بخش ایندکس‌گذاری خوش آمدید. ایندکس‌ها یکی از جذاب‌ترین و مهم‌ترین مباحث در دنیای پایگاه داده هستند و بهترین راه برای دستیابی به یک پایگاه داده با عملکرد بالا (performant database) محسوب می‌شوند.

---

#### **۱. هدف این بخش: ترکیبی از تئوری و عمل**

در این بخش، ما هم به مباحث کاملاً عملی که می‌توانید بلافاصله از آن‌ها استفاده کنید می‌پردازیم و هم کمی به تئوری‌های زیربنایی ایندکس‌ها خواهیم پرداخت. هدف از یادگیری تئوری، صرفاً افزایش دانش آکادمیک نیست، بلکه **تقویت شهود (intuition)** شماست. با درک نحوه کارکرد داخلی ایندکس‌ها، شما یک چارچوب ذهنی به دست می‌آورید که به شما کمک می‌کند در مواجهه با شرایط جدید و پیش‌بینی‌نشده، تصمیمات بهتری بگیرید، به جای اینکه فقط مجموعه‌ای از قوانین را حفظ کرده باشید.

---

#### **۲. مفاهیم سطح بالای ایندکس‌ها**

برای شروع، باید سه مفهوم اساسی و سطح بالا را در مورد ایندکس‌ها درک کنیم.

- **۱. ایندکس‌ها ساختارهای داده مجزا هستند.**
  مهم‌ترین نکته این است که یک ایندکس، یک ساختار داده (`data structure`) کاملاً مجزا و جدا از جدول شماست. اگرچه شما یک ایندکس را روی یک جدول تعریف می‌کنید، اما در واقع یک ساختار داده ثانویه ایجاد می‌شود که برای عملیات خاصی بهینه شده است. رایج‌ترین نوع این ساختار داده **B-tree** نام دارد. انواع دیگری نیز مانند `GiST`، `Hash` و `GIN` وجود دارند که به آن‌ها نیز خواهیم پرداخت، اما `B-tree` رایج‌ترین آن‌هاست.

- **۲. ایندکس‌ها یک کپی از داده را نگهداری می‌کنند.**
  این ساختار داده مجزا، یک **کپی از بخشی از داده‌های جدول شما** را نگهداری می‌کند. برای مثال، اگر روی ستون «نام خانوادگی» یک ایندکس بسازید، تمام نام‌های خانوادگی از جدول کپی شده و در ساختار ایندکس قرار می‌گیرند. این موضوع توضیح می‌دهد که چرا نباید برای همه چیز ایندکس بسازید. هر بار که داده‌ای را در جدول به‌روزرسانی می‌کنید (مثلاً نام خانوادگی یک شخص را تغییر می‌دهید)، ایندکس مربوط به آن نیز باید **نگهداری و به‌روز شود** (مقدار آن و موقعیت اش در جدول). این فرآیند زمان‌بر است و به آن **هزینه نگهداری (maintenance costs)** ایندکس می‌گویند. اگر روی یک جدول ۵۰ ایندکس داشته باشید، یک `UPDATE` ساده نیازمند به‌روزرسانی هر ۵۰ ایندکس خواهد بود.

<div class='centered-div'>
  <img src="../../assets/images/indexing/39_1.png">
</div>

- **۳. هر ایندکس یک اشاره‌گر به جدول دارد.**
  از آنجایی که ایندکس یک ساختار داده مجزاست، پس از جستجو در آن و پیدا کردن مقدار مورد نظر، ما به بقیه اطلاعات آن ردیف (مانند نام، ایمیل و...) نیاز داریم. برای این کار، هر ایندکس شامل یک **اشاره‌گر (pointer)** به جدول اصلی است تا بتوان به سرعت ردیف کامل را پیدا کرد.

<div class='centered-div'>
  <img src="../../assets/images/indexing/39_2.png">
</div>

یک تفاوت مهم PostgreSQL با سایر پایگاه‌های داده در اینجاست. در اکثر پایگاه‌های داده دیگر، این اشاره‌گر به **کلید اصلی (primary key)** اشاره دارد. اما در PostgreSQL، هر ایندکس شامل یک اشاره‌گر به **موقعیت فیزیکی (physical location)** آن ردیف در جدول است. این اشاره‌گر به ما اجازه می‌دهد که پس از پیمایش ایندکس، مستقیماً به محل فیزیکی ردیف در جدول رفته و آن را بازیابی کنیم، بدون نیاز به پیمایش کل جدول (`scan the entire table`).

---

#### **۴. جمع‌بندی**

به طور خلاصه، به یاد داشته باشید که یک ایندکس یک ساختار داده مجزا است که یک کپی از بخشی از داده‌های شما را نگهداری می‌کند (و بنابراین هزینه نگهداری دارد) و شامل یک اشاره‌گر برای دسترسی سریع به ردیف کامل در جدول اصلی است. در جلسات آینده، هم عمیق‌تر به تئوری و هم به جنبه‌های عملی کار با ایندکس‌ها خواهیم پرداخت.
