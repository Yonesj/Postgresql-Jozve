در این جلسه، افزونه `pgvector` را نصب کرده و یک جدول نمونه با یک ستون از نوع بردار (`vector`) ایجاد می‌کنیم تا برای کار با مفاهیم پیچیده‌تر آماده شویم.

---

### **۱. نصب و فعال‌سازی افزونه `pgvector`**

بسیاری از توزیع‌های آماده PostgreSQL (مانند Postgres.app برای مک) افزونه `pgvector` را به صورت پیش‌فرض به همراه دارند. در این حالت، تنها کاری که باید انجام دهید، فعال‌سازی آن در پایگاه داده مورد نظر است.

برای فعال‌سازی، کافی است دستور زیر را یک بار اجرا کنید:

```postgresql
CREATE EXTENSION IF NOT EXISTS vector;
```

اگر نیاز به نصب دستی این افزونه دارید، می‌توانید به [مخزن GitHub](https://github.com/pgvector/pgvector) آن مراجعه کرده و دستورالعمل‌های مربوط به سیستم عامل خود را دنبال کنید.

---

### **۲. ایجاد جدول با ستون از نوع `vector`**

برای ایجاد یک ستون از نوع بردار، باید **تعداد ابعاد (dimensionality)** آن را مشخص کنید. این عدد، تعداد اعداد float در آرایه بردار را تعیین می‌کند. تعداد ابعاد به مدلی که برای تولید امبدینگ استفاده می‌کنید، بستگی دارد (مقادیر رایج شامل ۷۶۸، ۱۰۲۴ یا بیشتر هستند).

```postgresql
CREATE TABLE products_v (
	id BIGINT GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
	name TEXT,
	embedding VECTOR(4)
);
```

در این مثال، برای سادگی، یک بردار با ۴ بعد تعریف کرده‌ایم.

---

### **۳. درج داده در ستون برداری**

برای درج داده، شما باید یک آرایه از اعداد ممیز شناور را به صورت یک رشته متنی در داخل براکت `[]` به ستون `embedding` ارسال کنید. این آرایه همان چیزی است که از یک مدل هوش مصنوعی (مانند OpenAI) به عنوان خروجی دریافت می‌کنید.

```postgresql
INSERT INTO 
	products_v (name, embedding) 
VALUES 
	('Product A', '[1,2,3,4]'),
	('Product B', '[10,11,12,13]');
```

در دنیای واقعی، این اعداد ممکن است بسیار پیچیده به نظر برسند، اما آن‌ها یک نمایش ریاضی از واقعیت (مانند توضیحات یک محصول یا پیکسل‌های یک تصویر) هستند که توسط ماشین قابل درک است.

---

### **۴. مقایسه بردارها و پیدا کردن شباهت**

پس از ذخیره کردن بردارها، می‌توانیم آن‌ها را با یک بردار ورودی جدید مقایسه کنیم تا شباهت‌شان را بسنجیم. `pgvector` چندین اپراتور برای این کار ارائه می‌دهد.

*   **اپراتور فاصله L2 (اقلیدسی): `<->`**
    این یکی از رایج‌ترین اپراتورهاست و **فاصله اقلیدسی** بین دو بردار را محاسبه می‌کند. هرچه عدد بازگشتی **کوچکتر** باشد، دو بردار به هم **شبیه‌تر** هستند. مقدار صفر به معنای یکسان بودن کامل است.

```postgresql
SELECT 
	name, 
	embedding <-> '[1,2,3,5]' AS distance 
FROM 
	producs_v;
```

خروجی این کوئری فاصله هر محصول را از بردار ورودی `[1,2,3,5]` محاسبه می‌کند.

---

### **۵. کاربرد عملی: پیدا کردن محصولات مرتبط**

با استفاده از این اپراتور فاصله، می‌توانیم به راحتی ویژگی "محصولات مرتبط" را پیاده‌سازی کنیم. برای این کار، کافی است نتایج را بر اساس فاصله محاسبه شده مرتب کنیم.

```postgresql
SELECT 
	name, embedding <-> '[1,2,3,5]' AS distance
FROM 
	products_v
ORDER BY 
	distance ASC;
```

این کوئری محصولات را از شبیه‌ترین به کم‌شباهت‌ترین، نسبت به بردار ورودی، مرتب می‌کند. بردار ورودی می‌تواند امبدینگ محصول فعلی (برای پیدا کردن محصولات مشابه) یا امبدینگ عبارت جستجوی کاربر (برای جستجوی معنایی) باشد.

---

### **۶. جمع‌بندی**

در این جلسه، یاد گرفتیم چگونه افزونه `pgvector` را فعال کرده، یک ستون برداری با ابعاد مشخص ایجاد کنیم، داده‌های امبدینگ را در آن درج کرده و با استفاده از اپراتور فاصله L2 (`<->`)، شباهت بین بردارها را محاسبه کنیم. این قابلیت به ما اجازه می‌دهد تا ویژگی‌های هوشمندی مانند توصیه‌گر محصولات را مستقیماً در داخل PostgreSQL پیاده‌سازی کنیم.